(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const w="https://bravemath-proxy.bravechien2209.workers.dev";async function x(){try{const e=await fetch("/data/documents.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error("Error loading documents:",e),e}}async function I(e,s){try{const n=`${w}/download/${e}`,t=document.getElementById("loading-modal");t&&t.classList.remove("hidden");const i=await fetch(n);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const o=await i.blob(),r=window.URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=s||"document.pdf",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r),t&&t.classList.add("hidden")}catch(n){console.error("Error downloading document:",n);const t=document.getElementById("loading-modal");throw t&&t.classList.add("hidden"),alert("Không thể tải tài liệu. Vui lòng thử lại sau."),n}}function k(e,s="",n={}){let t=[...e];if(s.trim()){const i=s.toLowerCase().trim();t=t.filter(o=>{var h,f,p;const r=o.title.toLowerCase().includes(i),a=(h=o.description)==null?void 0:h.toLowerCase().includes(i),c=(f=o.tags)==null?void 0:f.some(E=>E.toLowerCase().includes(i)),m=(p=o.subject)==null?void 0:p.toLowerCase().includes(i);return r||a||c||m})}return n.level&&(t=t.filter(i=>i.level===n.level)),n.subject&&(t=t.filter(i=>i.subject===n.subject)),n.category&&(t=t.filter(i=>i.category===n.category)),t}function y(e,s,n=5){if(!s.trim())return[];const t=s.toLowerCase().trim(),i=new Set;return e.forEach(o=>{o.title.toLowerCase().includes(t)&&i.add(o.title),o.tags&&o.tags.forEach(r=>{r.toLowerCase().includes(t)&&i.add(r)}),i.size>=n}),Array.from(i).slice(0,n)}function b(e,s,n){if(!s||s.length===0){e.classList.add("hidden");return}e.innerHTML="",e.classList.remove("hidden"),s.forEach(t=>{const i=document.createElement("div");i.className="px-4 py-2 hover:bg-background-dark cursor-pointer text-paragraph-dark hover:text-ocean-400 transition-colors",i.textContent=t,i.addEventListener("click",()=>{n(t),e.classList.add("hidden")}),e.appendChild(i)})}function C(e,s,n){if(!e)return;const t=e.querySelector("#results-text");t&&(s===n?t.textContent=`Hiển thị tất cả ${n} tài liệu`:t.textContent=`Tìm thấy ${s} / ${n} tài liệu`)}function B(){document.addEventListener("click",e=>{const s=e.target.closest("a");if(!s)return;const n=s.getAttribute("href");!n||n.startsWith("http")||n.startsWith("#")||n.startsWith("mailto:")||e.ctrlKey||e.metaKey||e.shiftKey})}let l=[],g=[],u={level:"",subject:"",category:""};document.addEventListener("DOMContentLoaded",async()=>{B(),$(),S(),O();try{await T()}catch(e){console.error("Error initializing app:",e),L("Không thể tải dữ liệu. Vui lòng thử lại sau.")}});async function T(){R();try{l=(await x()).documents||[],d()}catch(e){console.error("Error loading documents:",e),v(),L("Không thể tải danh sách tài liệu.")}}function d(){const e=document.getElementById("search-input")||document.getElementById("search-input-mobile"),s=(e==null?void 0:e.value)||"";g=k(l,s,u),M(g);const n=document.getElementById("results-count");n&&C(n,g.length,l.length),v()}function M(e){const s=document.getElementById("documents-grid"),n=document.getElementById("empty-state"),t=document.getElementById("loading-skeleton");if(s){if(t&&t.classList.add("hidden"),e.length===0){s.classList.add("hidden"),n&&n.classList.remove("hidden");return}s.classList.remove("hidden"),n&&n.classList.add("hidden"),s.innerHTML="",e.forEach(i=>{const o=j(i);s.appendChild(o)})}}function j(e){const s=document.createElement("div");s.className="document-card";const n=e.thumbnail||"/assets/images/thumbnails/meme-soi-co-doc-hai-huoc.jpg",t={"ly-thuyet":"Lý thuyết","de-thi":"Đề thi","bai-tap":"Bài tập","giai-chi-tiet":"Giải chi tiết"},i={thpt:"THPT",daihoc:"Đại học"};s.innerHTML=`
        <div class="mb-4">
            <img 
                src="${n}" 
                alt="${e.title}"
                class="w-full aspect-[210/297] object-cover rounded-lg mb-3"
                onerror="this.src='/assets/images/thumbnails/meme-soi-co-doc-hai-huoc.jpg'"
            >
            <div class="flex flex-wrap gap-2 mb-2">
                <span class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded">
                    ${i[e.level]||e.level}
                </span>
                <span class="px-2 py-1 bg-slate-700/50 text-slate-300 text-xs rounded">
                    ${t[e.category]||e.category}
                </span>
            </div>
        </div>
        <h3 class="font-math text-lg font-semibold text-white mb-2 line-clamp-2">
            ${e.title}
        </h3>
        <p class="text-slate-400 text-sm mb-3 line-clamp-2">
            ${e.description||""}
        </p>
        <div class="flex items-center justify-between text-xs text-slate-500 mb-4">
            <span>${e.pages||0} trang</span>
            <span>${e.fileSize||""}</span>
        </div>
        <button 
            class="btn-primary w-full download-btn" 
            data-drive-id="${e.driveId}"
            data-filename="${e.title.replace(/[^a-z0-9]/gi,"_")}.pdf"
        >
            Tải xuống
        </button>
    `;const o=s.querySelector(".download-btn");return o&&e.driveId&&e.driveId!=="YOUR_GOOGLE_DRIVE_FILE_ID_HERE"?o.addEventListener("click",async r=>{r.stopPropagation();const a=o.getAttribute("data-drive-id"),c=o.getAttribute("data-filename");try{await I(a,c)}catch(m){console.error("Download error:",m)}}):o&&(o.disabled=!0,o.classList.add("opacity-50","cursor-not-allowed"),o.textContent="Chưa có sẵn"),s}function $(){const e=document.getElementById("mobile-menu-btn"),s=document.getElementById("mobile-menu");e&&s&&e.addEventListener("click",()=>{s.classList.toggle("hidden")})}function S(){const e=document.getElementById("search-input"),s=document.getElementById("search-input-mobile"),n=document.getElementById("search-suggestions"),t=document.getElementById("search-suggestions-mobile");if(e&&n){let i;e.addEventListener("input",o=>{clearTimeout(i);const r=o.target.value;if(r.trim()){const a=y(l,r);b(n,a,c=>{e.value=c,d()})}else n.classList.add("hidden");i=setTimeout(()=>{d()},300)}),document.addEventListener("click",o=>{!e.contains(o.target)&&!n.contains(o.target)&&n.classList.add("hidden")})}if(s&&t){let i;s.addEventListener("input",o=>{clearTimeout(i);const r=o.target.value;if(r.trim()){const a=y(l,r);b(t,a,c=>{s.value=c,d()})}else t.classList.add("hidden");i=setTimeout(()=>{d()},300)}),document.addEventListener("click",o=>{!s.contains(o.target)&&!t.contains(o.target)&&t.classList.add("hidden")})}}function O(){const e=document.getElementById("filter-level"),s=document.getElementById("filter-subject"),n=document.getElementById("filter-category");e&&e.addEventListener("change",t=>{u.level=t.target.value,d()}),s&&s.addEventListener("change",t=>{u.subject=t.target.value,d()}),n&&n.addEventListener("change",t=>{u.category=t.target.value,d()})}function R(){const e=document.getElementById("loading-skeleton"),s=document.getElementById("documents-grid");if(e){e.classList.remove("hidden"),e.innerHTML="";for(let n=0;n<6;n++){const t=document.createElement("div");t.className="card animate-pulse",t.innerHTML=`
                <div class="h-48 bg-background-dark rounded-lg mb-4"></div>
                <div class="h-4 bg-background-dark rounded w-3/4 mb-2"></div>
                <div class="h-4 bg-background-dark rounded w-1/2 mb-4"></div>
                <div class="h-10 bg-background-dark rounded"></div>
            `,e.appendChild(t)}}s&&s.classList.add("hidden")}function v(){const e=document.getElementById("loading-skeleton");e&&e.classList.add("hidden")}function L(e){const s=document.getElementById("documents-grid"),n=document.getElementById("empty-state");if(s&&s.classList.add("hidden"),n){n.classList.remove("hidden");const t=n.querySelector("p");t&&(t.textContent=e)}}
