(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const b="https://bravemath-proxy.bravechien2209.workers.dev";async function I(){try{const e=await fetch("/data/documents.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error("Error loading documents:",e),e}}async function k(e,t){try{const s=`${b}/download/${e}`,n=document.getElementById("loading-modal");n&&n.classList.remove("hidden");const i=await fetch(s);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const o=await i.blob(),r=window.URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=t||"document.pdf",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r),n&&n.classList.add("hidden")}catch(s){console.error("Error downloading document:",s);const n=document.getElementById("loading-modal");throw n&&n.classList.add("hidden"),alert("Không thể tải tài liệu. Vui lòng thử lại sau."),s}}function x(e){const t=`${b}/preview/${e}`;window.open(t,"_blank")}function C(e,t="",s={}){let n=[...e];if(t.trim()){const i=t.toLowerCase().trim();n=n.filter(o=>{var u,f,p;const r=o.title.toLowerCase().includes(i),a=(u=o.description)==null?void 0:u.toLowerCase().includes(i),c=(f=o.tags)==null?void 0:f.some(w=>w.toLowerCase().includes(i)),g=(p=o.subject)==null?void 0:p.toLowerCase().includes(i);return r||a||c||g})}return s.level&&(n=n.filter(i=>i.level===s.level)),s.subject&&(n=n.filter(i=>i.subject===s.subject)),s.category&&(n=n.filter(i=>i.category===s.category)),n}function y(e,t,s=5){if(!t.trim())return[];const n=t.toLowerCase().trim(),i=new Set;return e.forEach(o=>{o.title.toLowerCase().includes(n)&&i.add(o.title),o.tags&&o.tags.forEach(r=>{r.toLowerCase().includes(n)&&i.add(r)}),i.size>=s}),Array.from(i).slice(0,s)}function v(e,t,s){if(!t||t.length===0){e.classList.add("hidden");return}e.innerHTML="",e.classList.remove("hidden"),t.forEach(n=>{const i=document.createElement("div");i.className="px-4 py-2 hover:bg-background-dark cursor-pointer text-paragraph-dark hover:text-ocean-400 transition-colors",i.textContent=n,i.addEventListener("click",()=>{s(n),e.classList.add("hidden")}),e.appendChild(i)})}function B(e,t,s){if(!e)return;const n=e.querySelector("#results-text");n&&(t===s?n.textContent=`Hiển thị tất cả ${s} tài liệu`:n.textContent=`Tìm thấy ${t} / ${s} tài liệu`)}function T(){document.addEventListener("click",e=>{const t=e.target.closest("a");if(!t)return;const s=t.getAttribute("href");!s||s.startsWith("http")||s.startsWith("#")||s.startsWith("mailto:")||e.ctrlKey||e.metaKey||e.shiftKey})}let l=[],h=[],m={level:"",subject:"",category:""};document.addEventListener("DOMContentLoaded",async()=>{T(),S(),D(),O();try{await M()}catch(e){console.error("Error initializing app:",e),E("Không thể tải dữ liệu. Vui lòng thử lại sau.")}});async function M(){R();try{l=(await I()).documents||[],d()}catch(e){console.error("Error loading documents:",e),L(),E("Không thể tải danh sách tài liệu.")}}function d(){const e=document.getElementById("search-input")||document.getElementById("search-input-mobile"),t=(e==null?void 0:e.value)||"";h=C(l,t,m),$(h);const s=document.getElementById("results-count");s&&B(s,h.length,l.length),L()}function $(e){const t=document.getElementById("documents-grid"),s=document.getElementById("empty-state"),n=document.getElementById("loading-skeleton");if(t){if(n&&n.classList.add("hidden"),e.length===0){t.classList.add("hidden"),s&&s.classList.remove("hidden");return}t.classList.remove("hidden"),s&&s.classList.add("hidden"),t.innerHTML="",e.forEach(i=>{const o=j(i);t.appendChild(o)})}}function j(e){const t=document.createElement("div");t.className="document-card";const s=e.thumbnail||"/assets/images/thumbnails/meme-soi-co-doc-hai-huoc.jpg",n={"ly-thuyet":"Lý thuyết","de-thi":"Đề thi","bai-tap":"Bài tập","giai-chi-tiet":"Giải chi tiết"},i={thpt:"THPT",daihoc:"Đại học"};t.innerHTML=`
        <div class="mb-4">
            <img 
                src="${s}" 
                alt="${e.title}"
                class="w-full aspect-[210/297] object-cover rounded-lg mb-3 cursor-pointer hover:opacity-80 transition-opacity"
                onerror="this.src='/assets/images/thumbnails/meme-soi-co-doc-hai-huoc.jpg'"
            >
            <div class="flex flex-wrap gap-2 mb-2">
                <span class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded">
                    ${i[e.level]||e.level}
                </span>
                <span class="px-2 py-1 bg-slate-700/50 text-slate-300 text-xs rounded">
                    ${n[e.category]||e.category}
                </span>
            </div>
        </div>
        <h3 class="font-math text-lg font-semibold text-white mb-2 line-clamp-2">
            ${e.title}
        </h3>
        <p class="text-slate-400 text-sm mb-3 line-clamp-2">
            ${e.description||""}
        </p>
        <div class="flex items-center justify-between text-xs text-slate-500 mb-4">
            <span>${e.pages||0} trang</span>
            <span>${e.fileSize||""}</span>
        </div>
        <button 
            class="btn-primary w-full download-btn" 
            data-drive-id="${e.driveId}"
            data-filename="${e.title.replace(/[^a-z0-9]/gi,"_")}.pdf"
        >
            Tải xuống
        </button>
    `;const o=t.querySelector("img");o&&e.driveId&&e.driveId!=="YOUR_GOOGLE_DRIVE_FILE_ID_HERE"&&o.addEventListener("click",a=>{a.preventDefault(),console.log("Preview clicked:",e.driveId),x(e.driveId)});const r=t.querySelector(".download-btn");return r&&e.driveId&&e.driveId!=="YOUR_GOOGLE_DRIVE_FILE_ID_HERE"?r.addEventListener("click",async a=>{a.stopPropagation();const c=r.getAttribute("data-drive-id"),g=r.getAttribute("data-filename");try{await k(c,g)}catch(u){console.error("Download error:",u)}}):r&&(r.disabled=!0,r.classList.add("opacity-50","cursor-not-allowed"),r.textContent="Chưa có sẵn"),t}function S(){const e=document.getElementById("mobile-menu-btn"),t=document.getElementById("mobile-menu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function D(){const e=document.getElementById("search-input"),t=document.getElementById("search-input-mobile"),s=document.getElementById("search-suggestions"),n=document.getElementById("search-suggestions-mobile");if(e&&s){let i;e.addEventListener("input",o=>{clearTimeout(i);const r=o.target.value;if(r.trim()){const a=y(l,r);v(s,a,c=>{e.value=c,d()})}else s.classList.add("hidden");i=setTimeout(()=>{d()},300)}),document.addEventListener("click",o=>{!e.contains(o.target)&&!s.contains(o.target)&&s.classList.add("hidden")})}if(t&&n){let i;t.addEventListener("input",o=>{clearTimeout(i);const r=o.target.value;if(r.trim()){const a=y(l,r);v(n,a,c=>{t.value=c,d()})}else n.classList.add("hidden");i=setTimeout(()=>{d()},300)}),document.addEventListener("click",o=>{!t.contains(o.target)&&!n.contains(o.target)&&n.classList.add("hidden")})}}function O(){const e=document.getElementById("filter-level"),t=document.getElementById("filter-subject"),s=document.getElementById("filter-category");e&&e.addEventListener("change",n=>{m.level=n.target.value,d()}),t&&t.addEventListener("change",n=>{m.subject=n.target.value,d()}),s&&s.addEventListener("change",n=>{m.category=n.target.value,d()})}function R(){const e=document.getElementById("loading-skeleton"),t=document.getElementById("documents-grid");if(e){e.classList.remove("hidden"),e.innerHTML="";for(let s=0;s<6;s++){const n=document.createElement("div");n.className="card animate-pulse",n.innerHTML=`
                <div class="h-48 bg-background-dark rounded-lg mb-4"></div>
                <div class="h-4 bg-background-dark rounded w-3/4 mb-2"></div>
                <div class="h-4 bg-background-dark rounded w-1/2 mb-4"></div>
                <div class="h-10 bg-background-dark rounded"></div>
            `,e.appendChild(n)}}t&&t.classList.add("hidden")}function L(){const e=document.getElementById("loading-skeleton");e&&e.classList.add("hidden")}function E(e){const t=document.getElementById("documents-grid"),s=document.getElementById("empty-state");if(t&&t.classList.add("hidden"),s){s.classList.remove("hidden");const n=s.querySelector("p");n&&(n.textContent=e)}}
